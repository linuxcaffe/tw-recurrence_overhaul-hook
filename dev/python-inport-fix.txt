# Python Import System and -x Suffix Issue
# Date: 2026-02-02

## The Problem: Python Can't Import Files with -x in the Name

**Error:**
```
ModuleNotFoundError: No module named 'recurrence_common_hook'
```

**Root Cause:**
I made an INCORRECT assumption that Python strips `-x` before `.py` when importing.

**Reality:**
- Filename: `recurrence_common_hook-x.py`
- Import: `from recurrence_common_hook import ...`
- Python looks for: `recurrence_common_hook.py` (EXACT match required!)
- Python does NOT look for: `recurrence_common_hook-x.py`

Python's import system requires EXACT filename matches (minus the .py extension).
The `-x` suffix makes it a completely different module name.

## Why This Happened:

The `-x` suffix was designed to mean "don't chmod +x during installation."
This works great for marking files as non-executable, but it breaks Python imports
because Python can't find the module.

**The conflict:**
- Naming convention: `recurrence_common_hook-x.py` (clear intent: not executable)
- Python imports: `from recurrence_common_hook import ...` (can't find it!)

## The Solution: Remove -x for Library Files

**Old filename:** `recurrence_common_hook-x.py`
**New filename:** `recurrence_common_hook.py`

**Why this works:**
1. Import statement stays the same: `from recurrence_common_hook import ...`
2. Python can now find the module
3. The `_hook` path marker indicates it goes to hooks/ directory
4. We add special logic in make-awesome.py to detect library files

## Updated make-awesome.py Logic:

Files in hooks/ directory should NOT be executable if:
1. They end with `-x.py` or `-x.sh` (explicit non-exec marker), OR
2. They contain `_hook` in filename AND don't start with `on-` (library pattern)

```python
is_executable = not (
    filename.endswith('-x.py') or 
    filename.endswith('-x.sh') or
    ('_hook' in filename and not filename.startswith('on-'))
)
```

**Examples:**
- `on-add_recurrence.py` → executable ✓ (starts with `on-`)
- `on-exit_recurrence.py` → executable ✓ (starts with `on-`)
- `recurrence_common_hook.py` → NOT executable ✓ (has `_hook`, not `on-*`)
- `utils_hook.sh` → NOT executable ✓ (has `_hook`, not `on-*`)
- `debug_hook-x.py` → NOT executable ✓ (has `-x` marker)

## Naming Convention for Libraries:

**Pattern:** `{name}_hook.{ext}` for libraries in hooks directory

The `_hook` suffix serves dual purpose:
1. **Path marker:** File goes to hooks/ directory (not scripts/)
2. **Library indicator:** Combined with not starting with `on-`, indicates it's not executable

## Files Changed:

1. **Renamed:** `recurrence_common_hook-x.py` → `recurrence_common_hook.py`
2. **Updated:** recurrence-overhaul.install
   - Download URL: `recurrence_common_hook.py`
   - Install path: `$HOOKS_DIR/recurrence_common_hook.py`
   - Manifest entry: `recurrence_common_hook.py`
3. **Updated:** on-add_recurrence.py documentation
4. **Updated:** on-exit_recurrence.py documentation
5. **Updated:** make-awesome.py hook installation logic

## Testing:

After pushing changes to GitHub and running:
```bash
tw -u recurrence-overhaul
tw --debug rr
```

Should no longer see:
```
ModuleNotFoundError: No module named 'recurrence_common_hook'
```

The import should succeed because Python can now find `recurrence_common_hook.py`.

## Lesson Learned:

The `-x` suffix is useful for shell scripts and standalone executables where the
filename doesn't matter for execution. But for Python libraries that need to be
imported, the filename MUST match the import statement exactly (minus .py).

For Python libraries, use the naming pattern approach instead:
- Name pattern indicates purpose: `{name}_hook.py` = library in hooks/
- Detection logic handles executability based on pattern, not suffix

## Status: FIXED ✓
